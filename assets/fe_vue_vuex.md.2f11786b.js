import{_ as s,c as n,o as a,a as l}from"./app.fe52f538.js";const C=JSON.parse('{"title":"vuex","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u5355\u72EC\u4F7F\u7528","slug":"\u5355\u72EC\u4F7F\u7528"},{"level":2,"title":"\u5206\u6A21\u5757\u4F7F\u7528","slug":"\u5206\u6A21\u5757\u4F7F\u7528"},{"level":2,"title":"\u76D1\u542C\u53D8\u5316","slug":"\u76D1\u542C\u53D8\u5316"}],"relativePath":"fe/vue/vuex.md","lastUpdated":1660531396000}'),p={name:"fe/vue/vuex.md"},o=l(`<h1 id="vuex" tabindex="-1">vuex <a class="header-anchor" href="#vuex" aria-hidden="true">#</a></h1><h2 id="\u5355\u72EC\u4F7F\u7528" tabindex="-1">\u5355\u72EC\u4F7F\u7528 <a class="header-anchor" href="#\u5355\u72EC\u4F7F\u7528" aria-hidden="true">#</a></h2><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> Vue </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">vue</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> Vuex </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">vuex</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> createPersistedState </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">vuex-persistedstate</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">Vue.</span><span style="color:#50FA7B;">use</span><span style="color:#F8F8F2;">(Vuex)</span></span>
<span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> store </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;font-weight:bold;">new</span><span style="color:#F8F8F2;"> Vuex.</span><span style="color:#50FA7B;">Store</span><span style="color:#F8F8F2;">({</span></span>
<span class="line"><span style="color:#F8F8F2;">  state</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    userInfo</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {}</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  mutations</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#50FA7B;">SET_USERINFO</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">state</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">payload</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      state.userInfo </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> payload</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  actions</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {},</span></span>
<span class="line"><span style="color:#F8F8F2;">  plugins</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#50FA7B;">createPersistedState</span><span style="color:#F8F8F2;">({</span></span>
<span class="line"><span style="color:#F8F8F2;">      storage</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#50FA7B;">getItem</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#FFB86C;font-style:italic;">key</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> sessionStorage.</span><span style="color:#50FA7B;">getItem</span><span style="color:#F8F8F2;">(key),</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#50FA7B;">setItem</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> (</span><span style="color:#FFB86C;font-style:italic;">key</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">value</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> sessionStorage.</span><span style="color:#50FA7B;">setItem</span><span style="color:#F8F8F2;">(key, value),</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#50FA7B;">removeItem</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#FFB86C;font-style:italic;">key</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> sessionStorage.</span><span style="color:#50FA7B;">removeItem</span><span style="color:#F8F8F2;">(key)</span></span>
<span class="line"><span style="color:#F8F8F2;">      }</span></span>
<span class="line"><span style="color:#F8F8F2;">    })</span></span>
<span class="line"><span style="color:#F8F8F2;">  ]</span></span>
<span class="line"><span style="color:#F8F8F2;">})</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">default</span><span style="color:#F8F8F2;"> store</span></span>
<span class="line"></span></code></pre></div><p><code>vuex-persistedstate</code>\u63D2\u4EF6\u662F\u6301\u4E45\u5316 vuex \u91CC\u7684\u6570\u636E\uFF0C\u9632\u6B62\u9875\u9762\u5237\u65B0\u540E\u6570\u636E\u4E22\u5931</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#6272A4;">// \u5B58\u50A8\u6570\u636E</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic;">this</span><span style="color:#F8F8F2;">.$store.</span><span style="color:#50FA7B;">commit</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">SET_USERINFO</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, userinfo)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// \u4F7F\u7528\u6570\u636E</span></span>
<span class="line"><span style="color:#BD93F9;font-style:italic;">this</span><span style="color:#F8F8F2;">.$store.state.userInfo</span></span>
<span class="line"></span></code></pre></div><h2 id="\u5206\u6A21\u5757\u4F7F\u7528" tabindex="-1">\u5206\u6A21\u5757\u4F7F\u7528 <a class="header-anchor" href="#\u5206\u6A21\u5757\u4F7F\u7528" aria-hidden="true">#</a></h2><p>index.js</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> Vue </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">vue</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> Vuex </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">vuex</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> modules </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">./modules</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">Vue.</span><span style="color:#50FA7B;">use</span><span style="color:#F8F8F2;">(Vuex)</span></span>
<span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> store </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;font-weight:bold;">new</span><span style="color:#F8F8F2;"> Vuex.</span><span style="color:#50FA7B;">Store</span><span style="color:#F8F8F2;">({ modules })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">default</span><span style="color:#F8F8F2;"> store</span></span>
<span class="line"></span></code></pre></div><p><code>modules</code>\u6587\u4EF6\u5939\u4E0B\u6709<code>index.js</code>\u3001<code>account.js</code>\u3001<code>setting.js</code>\u7B49\u6A21\u5757\uFF0C</p><p>index.js</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> account </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">./account</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> setting </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">./setting</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">default</span><span style="color:#F8F8F2;"> { account, setting }</span></span>
<span class="line"></span></code></pre></div><p>account.js</p><div class="language-js"><span class="copy"></span><pre><code><span class="line"><span style="color:#FF79C6;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  namespaced</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">true</span><span style="color:#F8F8F2;">, </span><span style="color:#6272A4;">// \u547D\u540D\u7A7A\u95F4</span></span>
<span class="line"><span style="color:#F8F8F2;">  state</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    user</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">undefined</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  getters</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#50FA7B;">user</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#FFB86C;font-style:italic;">state</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (</span><span style="color:#FF79C6;">!</span><span style="color:#F8F8F2;">state.user) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        </span><span style="color:#FF79C6;">try</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">          </span><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> user </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> localStorage.</span><span style="color:#50FA7B;">getItem</span><span style="color:#F8F8F2;">(process.<wbr>env.</span><span style="color:#BD93F9;">VUE_APP_USER_KEY</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">          state.user </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">JSON</span><span style="color:#F8F8F2;">.</span><span style="color:#8BE9FD;">parse</span><span style="color:#F8F8F2;">(user)</span></span>
<span class="line"><span style="color:#F8F8F2;">        } </span><span style="color:#FF79C6;">catch</span><span style="color:#F8F8F2;"> (e) {</span></span>
<span class="line"><span style="color:#F8F8F2;">          console.</span><span style="color:#50FA7B;">error</span><span style="color:#F8F8F2;">(e)</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#F8F8F2;">      }</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#FF79C6;">return</span><span style="color:#F8F8F2;"> state.user</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  mutations</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#50FA7B;">setUser</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">state</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">user</span><span style="color:#F8F8F2;">) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      state.user </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> user</span></span>
<span class="line"><span style="color:#F8F8F2;">      localStorage.</span><span style="color:#50FA7B;">setItem</span><span style="color:#F8F8F2;">(process.<wbr>env.</span><span style="color:#BD93F9;">VUE_APP_USER_KEY</span><span style="color:#F8F8F2;">, </span><span style="color:#BD93F9;">JSON</span><span style="color:#F8F8F2;">.</span><span style="color:#8BE9FD;">stringify</span><span style="color:#F8F8F2;">(user))</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5728\u7EC4\u4EF6\u4E2D\u4F7F\u7528\uFF0C</p><div class="language-vue"><span class="copy"></span><pre><code><span class="line"><span style="color:#F8F8F2;">&lt;</span><span style="color:#FF79C6;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#FF79C6;">import</span><span style="color:#F8F8F2;"> { mapMutations } </span><span style="color:#FF79C6;">from</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">vuex</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#FF79C6;">export</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">default</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  methods</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">...</span><span style="color:#50FA7B;">mapMutations</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">account</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, [</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">setUser</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">])  </span><span style="color:#6272A4;">// account\u8868\u793A\u6A21\u5757\u547D\u540D\u7A7A\u95F4\uFF0C\u540E\u9762\u6570\u7EC4\u8868\u793Amutations\u91CC\u7684\u65B9\u6CD5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#50FA7B;">init</span><span style="color:#F8F8F2;">() {</span></span>
<span class="line"><span style="color:#F8F8F2;">      this.setUser({ name</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">zgh</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, age</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">23</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#6272A4;">// \u6216\u8005\u4F7F\u7528\u5982\u4E0B\u7684\u65B9\u5F0F</span></span>
<span class="line"><span style="color:#F8F8F2;">      </span><span style="color:#BD93F9;font-style:italic;">this</span><span style="color:#F8F8F2;">.$store.</span><span style="color:#50FA7B;">commit</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">account/setUser</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, { name</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">zgh</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, age</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">23</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#F8F8F2;">&lt;/</span><span style="color:#FF79C6;">script</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"></span></code></pre></div><h2 id="\u76D1\u542C\u53D8\u5316" tabindex="-1">\u76D1\u542C\u53D8\u5316 <a class="header-anchor" href="#\u76D1\u542C\u53D8\u5316" aria-hidden="true">#</a></h2><p>\u5148\u5728<code>computed</code>\u4E2D\u62FF\u5230\u503C\uFF0C\u7136\u540E\u5728<code>watch</code>\u4E2D\u76D1\u542C\u5373\u53EF</p><div class="language-vue"><span class="copy"></span><pre><code><span class="line"><span style="color:#F8F8F2;"> computed: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    refreshData() {</span></span>
<span class="line"><span style="color:#F8F8F2;">      return this.$store.state.ship.shipFocus</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#F8F8F2;">  watch: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    refreshData(v) {</span></span>
<span class="line"><span style="color:#F8F8F2;">      if (v) {</span></span>
<span class="line"><span style="color:#F8F8F2;">        this.getData()</span></span>
<span class="line"><span style="color:#F8F8F2;">      }</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"></span></code></pre></div>`,18),F=[o];function e(t,c,r,y,i,d){return a(),n("div",null,F)}var m=s(p,[["render",e]]);export{C as __pageData,m as default};
