import{_ as s,c as a,o as n,Q as l}from"./chunks/framework.f14b72c3.js";const h=JSON.parse('{"title":"MongoDB","description":"","frontmatter":{},"headers":[],"relativePath":"fe/node/mongodb.md","lastUpdated":1685193505000}'),o={name:"fe/node/mongodb.md"},p=l(`<h1 id="mongodb" tabindex="-1">MongoDB <a class="header-anchor" href="#mongodb" aria-label="Permalink to &quot;MongoDB&quot;">​</a></h1><h2 id="简介" tabindex="-1">简介 <a class="header-anchor" href="#简介" aria-label="Permalink to &quot;简介&quot;">​</a></h2><p><a href="https://docs.mongodb.com" target="_blank" rel="noreferrer">官网文档</a></p><p><a href="http://www.mongodb.org.cn/" target="_blank" rel="noreferrer">中文文档</a></p><p><a href="https://mongoosejs.com/docs/index.html" target="_blank" rel="noreferrer">Mongoose 文档</a></p><p>MongoDB 是一个基于分布式文件存储的数据库。由 C++语言编写，旨在为 WEB 应用提供可扩展的高性能数据存储解决方案。</p><p>MongoDB 是一个介于<strong>关系数据库</strong>和<strong>非关系数据库</strong>之间的产品，是非关系数据库当中功能最丰富，最像关系数据库的。</p><h2 id="核心概念" tabindex="-1">核心概念 <a class="header-anchor" href="#核心概念" aria-label="Permalink to &quot;核心概念&quot;">​</a></h2><ul><li><p><strong>数据库</strong>（database） 数据库是一个数据仓库，数据库服务下可以创建很多数据库，数据库中可以存放很多集合</p></li><li><p><strong>集合</strong>（collection） 集合类似于 JS 中的数组，在集合中可以存放很多文档</p></li><li><p><strong>文档</strong>（document） 文档是数据库中的最小单位，类似于 JS 中的对象</p></li></ul><p><img src="https://zghimg.oss-cn-beijing.aliyuncs.com/blog/1685026945.jpg" alt="img"></p><p>通过 JSON 文件来理解 Mongodb 中的概念</p><ul><li>一个 <strong>JSON 文件</strong> 就像是一个 <strong>数据库</strong>，一个 Mongodb 服务下可以有 N 个数据库</li><li>JSON 文件中的 <strong>一级属性的数组值</strong> 就像是 <strong>集合</strong></li><li>数组中的对象就像是 <strong>文档</strong></li><li>对象中的属性有时也称之为 <strong>字段</strong></li></ul><p>一般情况下，一个项目使用一个数据库，一个集合会存储同一种类型的数据</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">users</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [</span></span>
<span class="line"><span style="color:#F8F8F2;">    { </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">id</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">name</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">张三</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">    { </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">id</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">2</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">name</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">李四</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">    { </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">id</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">3</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">name</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">王五</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"><span style="color:#F8F8F2;">  ],</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">books</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [</span></span>
<span class="line"><span style="color:#F8F8F2;">    { </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">id</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">name</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">你不知道的JS(上)</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">    { </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">id</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">2</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">name</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">你不知道的JS(中)</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">    { </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">id</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">3</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FE;">&quot;</span><span style="color:#8BE9FD;">name</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">你不知道的JS(下)</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"><span style="color:#F8F8F2;">  ]</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="命令行交互" tabindex="-1">命令行交互 <a class="header-anchor" href="#命令行交互" aria-label="Permalink to &quot;命令行交互&quot;">​</a></h2><h3 id="数据库命令" tabindex="-1">数据库命令 <a class="header-anchor" href="#数据库命令" aria-label="Permalink to &quot;数据库命令&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;"># 显示所有的数据库</span></span>
<span class="line"><span style="color:#F8F8F2;">show </span><span style="color:#F1FA8C;">dbs</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 切换到指定的数据库，如果数据库不存在会自动创建数据库</span></span>
<span class="line"><span style="color:#F8F8F2;">use </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">数据库名</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 显示当前所在的数据库</span></span>
<span class="line"><span style="color:#F8F8F2;">db</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 删除当前数据库</span></span>
<span class="line"><span style="color:#F8F8F2;">use </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">库名</span><span style="color:#E9F284;">&#39;</span></span>
<span class="line"><span style="color:#50FA7B;">db.dropDatabase</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"></span></code></pre></div><h3 id="集合命令" tabindex="-1">集合命令 <a class="header-anchor" href="#集合命令" aria-label="Permalink to &quot;集合命令&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;"># 创建集合</span></span>
<span class="line"><span style="color:#F8F8F2;">db.createCollection(&#39;集合名称&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 显示当前数据库中的所有集合</span></span>
<span class="line"><span style="color:#F8F8F2;">show </span><span style="color:#F1FA8C;">collections</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 删除某个集合</span></span>
<span class="line"><span style="color:#50FA7B;">db.&#39;集合名&#39;.drop</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 重命名集合</span></span>
<span class="line"><span style="color:#F8F8F2;">db.&#39;集合名&#39;.renameCollection(&#39;newName&#39;)</span></span>
<span class="line"></span></code></pre></div><h3 id="文档命令" tabindex="-1">文档命令 <a class="header-anchor" href="#文档命令" aria-label="Permalink to &quot;文档命令&quot;">​</a></h3><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;"># 插入文档</span></span>
<span class="line"><span style="color:#F8F8F2;">db.&#39;集合名&#39;.insert(&#39;文档对象&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 查询文档</span></span>
<span class="line"><span style="color:#6272A4;"># _id 是 mongodb 自动生成的唯一编号，用来唯一标识文档</span></span>
<span class="line"><span style="color:#F8F8F2;">db.&#39;集合名&#39;.find(&#39;查询条件&#39;)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 更新文档</span></span>
<span class="line"><span style="color:#F8F8F2;">db.&#39;集合名&#39;.update(&#39;查询条件&#39;, </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">新的文档</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">db.&#39;集合名&#39;.update({ name: </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">张三</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">},</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">{</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">$set</span><span style="color:#F1FA8C;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">{</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">age:</span><span style="color:#BD93F9;">19</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">}</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">}</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;"># 删除文档</span></span>
<span class="line"><span style="color:#F8F8F2;">db.&#39;集合名&#39;.remove(&#39;查询条件&#39;)</span></span>
<span class="line"></span></code></pre></div><h2 id="mongoose" tabindex="-1">Mongoose <a class="header-anchor" href="#mongoose" aria-label="Permalink to &quot;Mongoose&quot;">​</a></h2><p>Mongoose 是一个对象文档模型库，方便使用代码操作 mongodb 数据库</p><h3 id="使用方式" tabindex="-1">使用方式 <a class="header-anchor" href="#使用方式" aria-label="Permalink to &quot;使用方式&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// 安装、导入 mongoose</span></span>
<span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> mongoose </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">mongoose</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 连接数据库，数据库名称是 mydb</span></span>
<span class="line"><span style="color:#F8F8F2;">mongoose.</span><span style="color:#50FA7B;">connect</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">mongodb://127.0.0.1:27017/mydb</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 连接成功</span></span>
<span class="line"><span style="color:#F8F8F2;">mongoose.connection.</span><span style="color:#50FA7B;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">open</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">连接成功</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#6272A4;">// 设置集合中文档的属性以及属性值的类型</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">let</span><span style="color:#F8F8F2;"> BookSchema </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;font-weight:bold;">new</span><span style="color:#F8F8F2;"> mongoose.</span><span style="color:#50FA7B;">Schema</span><span style="color:#F8F8F2;">({ title</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> String, author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> String, price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> Number });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#6272A4;">// 创建文档模型对象</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">let</span><span style="color:#F8F8F2;"> BookModel </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> mongoose.</span><span style="color:#50FA7B;">model</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">book</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, BookSchema);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#6272A4;">// 插入文档</span></span>
<span class="line"><span style="color:#F8F8F2;">  BookModel.</span><span style="color:#50FA7B;">create</span><span style="color:#F8F8F2;">({ title</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">一气化三清</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">老子</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">100</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;">// 断开连接</span></span>
<span class="line"><span style="color:#F8F8F2;">    mongoose.</span><span style="color:#50FA7B;">disconnect</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  });</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 连接出错</span></span>
<span class="line"><span style="color:#F8F8F2;">mongoose.connection.</span><span style="color:#50FA7B;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">error</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">连接出错</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 连接关闭</span></span>
<span class="line"><span style="color:#F8F8F2;">mongoose.connection.</span><span style="color:#50FA7B;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">close</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">连接关闭</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="文档字段类型" tabindex="-1">文档字段类型 <a class="header-anchor" href="#文档字段类型" aria-label="Permalink to &quot;文档字段类型&quot;">​</a></h3><p>文档结构可选的常用字段类型列表</p><table><thead><tr><th>类型</th><th>描述</th></tr></thead><tbody><tr><td>String</td><td>字符串</td></tr><tr><td>Number</td><td>数字</td></tr><tr><td>Boolean</td><td>布尔值</td></tr><tr><td>Array</td><td>数组，也可以使用 [] 来标识</td></tr><tr><td>Date</td><td>日期</td></tr><tr><td>Buffer</td><td>Buffer 对象</td></tr><tr><td>Mixed</td><td>任意类型，需要使用 mongoose.Schema.Types.Mixed 指定</td></tr><tr><td>ObjectId</td><td>对象 ID，需要使用 mongoose.Schema.Types.ObjectId 指定</td></tr><tr><td>Decimal128</td><td>高精度数字，需要使用 mongoose.Schema.Types.Decimal128 指定</td></tr></tbody></table><h3 id="字段值验证" tabindex="-1">字段值验证 <a class="header-anchor" href="#字段值验证" aria-label="Permalink to &quot;字段值验证&quot;">​</a></h3><p>Mongoose 有一些内建验证器，可以对字段值进行验证</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// 必填项</span></span>
<span class="line"><span style="color:#F8F8F2;">title: { type: String, required: </span><span style="color:#BD93F9;">true</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 默认值</span></span>
<span class="line"><span style="color:#F8F8F2;">author: { type: String, </span><span style="color:#FF79C6;">default</span><span style="color:#F8F8F2;">: </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">匿名</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 枚举值，设置的值必须是数组中的</span></span>
<span class="line"><span style="color:#F8F8F2;">gender: { type: String, enum: [</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">男</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">,</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">女</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">] }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 唯一值</span></span>
<span class="line"><span style="color:#F8F8F2;">username: { type: String, unique: </span><span style="color:#BD93F9;">true</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"></span></code></pre></div><h2 id="curd" tabindex="-1">CURD <a class="header-anchor" href="#curd" aria-label="Permalink to &quot;CURD&quot;">​</a></h2><p>数据库的基本操作包括四个，增加（create），删除（delete），修改（update），查（read）</p><h3 id="增加" tabindex="-1">增加 <a class="header-anchor" href="#增加" aria-label="Permalink to &quot;增加&quot;">​</a></h3><p>插入一条</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">create</span><span style="color:#F8F8F2;">({ title</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">给我一首歌的时间</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">Jay</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data); </span><span style="color:#6272A4;">// 插入后的数据对象</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><p>批量插入</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> mongoose </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">require</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">mongoose</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">mongoose.</span><span style="color:#50FA7B;">connect</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">mongodb://127.0.0.1:27017/mydb</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">mongoose.connection.</span><span style="color:#50FA7B;">on</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">open</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, () </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#6272A4;">// 声明文档结构</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> PhoneSchema </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;font-weight:bold;">new</span><span style="color:#F8F8F2;"> mongoose.</span><span style="color:#50FA7B;">Schema</span><span style="color:#F8F8F2;">({ brand</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> String, color</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> String, price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> Number, tags</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> Array });</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#6272A4;">// 创建模型对象</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> PhoneModel </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> mongoose.</span><span style="color:#50FA7B;">model</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">phone</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, PhoneSchema);</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> phoneData </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> [</span></span>
<span class="line"><span style="color:#F8F8F2;">    { brand</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">iphone</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, color</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">dark purple</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">8999</span><span style="color:#F8F8F2;"> },</span></span>
<span class="line"><span style="color:#F8F8F2;">    { brand</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">xiaomi</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, color</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">red</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">3499</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"><span style="color:#F8F8F2;">  ];</span></span>
<span class="line"><span style="color:#F8F8F2;">  PhoneModel.</span><span style="color:#50FA7B;">insertMany</span><span style="color:#F8F8F2;">(phoneData, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">写入成功</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  });</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="删除" tabindex="-1">删除 <a class="header-anchor" href="#删除" aria-label="Permalink to &quot;删除&quot;">​</a></h3><p>删除一条数据</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">deleteOne</span><span style="color:#F8F8F2;">({ _id</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">5dd65f32be6401035cb5b1ed</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">删除成功</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><p>批量删除</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">deleteMany</span><span style="color:#F8F8F2;">({ author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">Jay</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">删除成功</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="更新" tabindex="-1">更新 <a class="header-anchor" href="#更新" aria-label="Permalink to &quot;更新&quot;">​</a></h3><p>更新一条数据</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">updateOne</span><span style="color:#F8F8F2;">({ author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">zhangsan</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, { author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">张三</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><p>批量更新数据</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">updateMany</span><span style="color:#F8F8F2;">({ author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">lisi</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, { author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">李四</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="查询" tabindex="-1">查询 <a class="header-anchor" href="#查询" aria-label="Permalink to &quot;查询&quot;">​</a></h3><p>查询一条数据</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">findOne</span><span style="color:#F8F8F2;">({ author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">Jay</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 根据 id 查询数据</span></span>
<span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">findById</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">5dd662b5381fc316b44ce167</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><p>批量查询数据</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// 不加条件查询</span></span>
<span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">((</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 加条件查询</span></span>
<span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">Jay</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">  mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h2 id="条件控制" tabindex="-1">条件控制 <a class="header-anchor" href="#条件控制" aria-label="Permalink to &quot;条件控制&quot;">​</a></h2><p>运算符 在 mongodb 不能使用 <code>&gt; 、&lt;、 &gt;=、 &lt;=、 !==</code> 等运算符，需要使用替代符号</p><table><thead><tr><th style="text-align:center;">运算符</th><th style="text-align:center;">替代符号</th></tr></thead><tbody><tr><td style="text-align:center;">&gt;</td><td style="text-align:center;">$gt</td></tr><tr><td style="text-align:center;">&lt;</td><td style="text-align:center;">$lt</td></tr><tr><td style="text-align:center;">=</td><td style="text-align:center;">$gte</td></tr><tr><td style="text-align:center;">&lt;=</td><td style="text-align:center;">$lte</td></tr><tr><td style="text-align:center;">!==</td><td style="text-align:center;">$ne</td></tr></tbody></table><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// id 号比 3 大的所有的记录</span></span>
<span class="line"><span style="color:#F8F8F2;">db.students.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ id</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { $gt</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">3</span><span style="color:#F8F8F2;"> } });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 价格小于 20 的图书</span></span>
<span class="line"><span style="color:#F8F8F2;">BookModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { $lt</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">20</span><span style="color:#F8F8F2;"> } }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="逻辑运算" tabindex="-1">逻辑运算 <a class="header-anchor" href="#逻辑运算" aria-label="Permalink to &quot;逻辑运算&quot;">​</a></h3><p><code>$or</code> 逻辑或</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">db.students.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ $or</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [{ age</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">18</span><span style="color:#F8F8F2;"> }, { age</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">24</span><span style="color:#F8F8F2;"> }] });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">BookModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ $or</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [{ author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">张三</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }, { author</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">李四</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> }] }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><p><code>$and</code> 逻辑与</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">db.students.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ $and</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [{ age</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { $lt</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">20</span><span style="color:#F8F8F2;"> } }, { age</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { $gt</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">15</span><span style="color:#F8F8F2;"> } }] });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">// 价格大于 30 且 小于 100</span></span>
<span class="line"><span style="color:#F8F8F2;">BookModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ $and</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> [{ price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { $gt</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">10</span><span style="color:#F8F8F2;"> } }, { price</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { $lt</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">100</span><span style="color:#F8F8F2;"> } }] }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="正则匹配" tabindex="-1">正则匹配 <a class="header-anchor" href="#正则匹配" aria-label="Permalink to &quot;正则匹配&quot;">​</a></h3><p>条件中可以直接使用 JS 的正则语法，通过正则可以进行模糊查询</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">db.students.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ name</span><span style="color:#FF79C6;">:</span><span style="color:#F1FA8C;"> </span><span style="color:#FF5555;">/</span><span style="color:#F1FA8C;">san</span><span style="color:#FF5555;">/</span><span style="color:#F8F8F2;"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">BookModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ name</span><span style="color:#FF79C6;">:</span><span style="color:#F1FA8C;"> </span><span style="color:#FF5555;">/</span><span style="color:#F1FA8C;">三</span><span style="color:#FF5555;">/</span><span style="color:#F8F8F2;"> }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">BookModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">({ name</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;font-weight:bold;">new</span><span style="color:#F8F8F2;"> </span><span style="color:#50FA7B;">RegExp</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">三</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;">) }, (</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">  </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">  console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h2 id="个性化读取" tabindex="-1">个性化读取 <a class="header-anchor" href="#个性化读取" aria-label="Permalink to &quot;个性化读取&quot;">​</a></h2><p>字段筛选</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// 0: 不要的字段</span></span>
<span class="line"><span style="color:#6272A4;">// 1: 要的字段</span></span>
<span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">select</span><span style="color:#F8F8F2;">({ _id</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">0</span><span style="color:#F8F8F2;">, title</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">exec</span><span style="color:#F8F8F2;">((</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">    mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  });</span></span>
<span class="line"></span></code></pre></div><p>数据排序</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// sort 排序</span></span>
<span class="line"><span style="color:#6272A4;">// 1: 升序</span></span>
<span class="line"><span style="color:#6272A4;">// -1: 倒序</span></span>
<span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">sort</span><span style="color:#F8F8F2;">({ hot</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;"> })</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">exec</span><span style="color:#F8F8F2;">((</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">    mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  });</span></span>
<span class="line"></span></code></pre></div><p>数据截取</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#6272A4;">// skip 跳过， limit 限定</span></span>
<span class="line"><span style="color:#F8F8F2;">SongModel.</span><span style="color:#50FA7B;">find</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">skip</span><span style="color:#F8F8F2;">(</span><span style="color:#BD93F9;">10</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">limit</span><span style="color:#F8F8F2;">(</span><span style="color:#BD93F9;">10</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">  .</span><span style="color:#50FA7B;">exec</span><span style="color:#F8F8F2;">((</span><span style="color:#FFB86C;font-style:italic;">err</span><span style="color:#F8F8F2;">, </span><span style="color:#FFB86C;font-style:italic;">data</span><span style="color:#F8F8F2;">) </span><span style="color:#FF79C6;">=&gt;</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#FF79C6;">if</span><span style="color:#F8F8F2;"> (err) </span><span style="color:#FF79C6;">throw</span><span style="color:#F8F8F2;"> err;</span></span>
<span class="line"><span style="color:#F8F8F2;">    console.</span><span style="color:#50FA7B;">log</span><span style="color:#F8F8F2;">(data);</span></span>
<span class="line"><span style="color:#F8F8F2;">    mongoose.connection.</span><span style="color:#50FA7B;">close</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">  });</span></span>
<span class="line"></span></code></pre></div><h2 id="图形化管理工具" tabindex="-1">图形化管理工具 <a class="header-anchor" href="#图形化管理工具" aria-label="Permalink to &quot;图形化管理工具&quot;">​</a></h2><p>可以使用图形化的管理工具来对 Mongodb 进行交互</p><ul><li><a href="https://github.com/Studio3T/robomongo/releases" target="_blank" rel="noreferrer">Robo 3T 免费</a></li><li><a href="https://www.navicat.com.cn/" target="_blank" rel="noreferrer">Navicat 收费</a></li></ul><h2 id="原子操作" tabindex="-1">原子操作 <a class="header-anchor" href="#原子操作" aria-label="Permalink to &quot;原子操作&quot;">​</a></h2><h3 id="set" tabindex="-1">$set <a class="header-anchor" href="#set" aria-label="Permalink to &quot;\\$set&quot;">​</a></h3><p>用来指定一个键并更新键值，若键不存在则创建。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> { title, content, contentText, category } </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> req.body;</span></span>
<span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> data </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">await</span><span style="color:#F8F8F2;"> article.</span><span style="color:#50FA7B;">findById</span><span style="color:#F8F8F2;">(id);</span></span>
<span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> updateData </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">await</span><span style="color:#F8F8F2;"> data.</span><span style="color:#50FA7B;">update</span><span style="color:#F8F8F2;">({</span></span>
<span class="line"><span style="color:#F8F8F2;">  $set</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { title, content, contentText, category }</span></span>
<span class="line"><span style="color:#F8F8F2;">});</span></span>
<span class="line"></span></code></pre></div><h3 id="inc" tabindex="-1">$inc <a class="header-anchor" href="#inc" aria-label="Permalink to &quot;\\$inc&quot;">​</a></h3><p>对文档的某个值为数字型（只能为满足要求的数字）的键进行增减。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#FF79C6;">const</span><span style="color:#F8F8F2;"> data </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> </span><span style="color:#FF79C6;">await</span><span style="color:#F8F8F2;"> article.</span><span style="color:#50FA7B;">findOneAndUpdate</span><span style="color:#F8F8F2;">(</span></span>
<span class="line"><span style="color:#F8F8F2;">  { _id</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> id },</span></span>
<span class="line"><span style="color:#F8F8F2;">  {</span></span>
<span class="line"><span style="color:#F8F8F2;">    $inc</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> { looknums</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;"> }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;">// 阅读量每次增加1</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span><span style="color:#6272A4;">// 若需要减少1，可写成 $inc: {looknums: -1}</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">res.</span><span style="color:#50FA7B;">json</span><span style="color:#F8F8F2;">({ code</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#BD93F9;">200</span><span style="color:#F8F8F2;">, data</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> data, msg</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> </span><span style="color:#E9F284;">&#39;</span><span style="color:#F1FA8C;">阅读量修改成功</span><span style="color:#E9F284;">&#39;</span><span style="color:#F8F8F2;"> });</span></span>
<span class="line"></span></code></pre></div><h3 id="unset" tabindex="-1">$unset <a class="header-anchor" href="#unset" aria-label="Permalink to &quot;\\$unset&quot;">​</a></h3><p>用来删除一个键</p><h3 id="push" tabindex="-1">$push <a class="header-anchor" href="#push" aria-label="Permalink to &quot;\\$push&quot;">​</a></h3><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">  $push: {</span></span>
<span class="line"><span style="color:#F8F8F2;">    field: value;</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span></code></pre></div><p>把 value 追加到 field 里面去，field 一定要是数组类型才行，如果 field 不存在，会新增一个数组类型加进去。</p><h3 id="pushall" tabindex="-1">$pushAll <a class="header-anchor" href="#pushall" aria-label="Permalink to &quot;\\$pushAll&quot;">​</a></h3><p>同$push,只是一次可以追加多个值到一个数组字段内。</p><h3 id="pull" tabindex="-1">$pull <a class="header-anchor" href="#pull" aria-label="Permalink to &quot;\\$pull&quot;">​</a></h3><p>从数组 field 内删除一个等于 value 值。</p><h3 id="addtoset" tabindex="-1">$addToSet <a class="header-anchor" href="#addtoset" aria-label="Permalink to &quot;\\$addToSet&quot;">​</a></h3><p>增加一个值到数组内，而且只有当这个值不在数组内才增加。</p><h3 id="pop" tabindex="-1">$pop <a class="header-anchor" href="#pop" aria-label="Permalink to &quot;\\$pop&quot;">​</a></h3><p>删除数组的第一个或最后一个元素</p><h3 id="rename" tabindex="-1">$rename <a class="header-anchor" href="#rename" aria-label="Permalink to &quot;\\$rename&quot;">​</a></h3><p>修改字段名称</p><h2 id="faq" tabindex="-1">FAQ <a class="header-anchor" href="#faq" aria-label="Permalink to &quot;FAQ&quot;">​</a></h2><h3 id="端口占用" tabindex="-1">端口占用 <a class="header-anchor" href="#端口占用" aria-label="Permalink to &quot;端口占用&quot;">​</a></h3><p>报错信息：</p><div class="language-sh"><button title="Copy Code" class="copy"></button><span class="lang">sh</span><pre class="shiki dracula"><code><span class="line"><span style="color:#F8F8F2;"> Unclean </span><span style="color:#F1FA8C;">full-time</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">diagnostic</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">data</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">capture</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">shutdown</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">detected,</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">found</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">interim</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">file,</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">some</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">metrics</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">may</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">have</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">been</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">lost.</span><span style="color:#F8F8F2;"> </span><span style="color:#F1FA8C;">OK</span></span>
<span class="line"></span></code></pre></div><p>解决方法：找到项目存放 data 的地方，删除<code>diagnostic.data</code>文件夹即可</p>`,102),F=[p];function e(t,c,r,y,i,d){return n(),a("div",null,F)}const u=s(o,[["render",e]]);export{h as __pageData,u as default};
